/**
 * @license RequireJS domReady 2.0.1 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/domReady for details
 */

define("domReady",[],function(){function u(e){var t;for(t=0;t<e.length;t+=1)e[t](s)}function a(){var e=o;i&&e.length&&(o=[],u(e))}function f(){i||(i=!0,n&&clearInterval(n),a())}function c(e){return i?e(s):o.push(e),c}var e,t,n,r=typeof window!="undefined"&&window.document,i=!r,s=r?document:null,o=[];if(r){if(document.addEventListener)document.addEventListener("DOMContentLoaded",f,!1),window.addEventListener("load",f,!1);else if(window.attachEvent){window.attachEvent("onload",f),t=document.createElement("div");try{e=window.frameElement===null}catch(l){}t.doScroll&&e&&window.external&&(n=setInterval(function(){try{t.doScroll(),f()}catch(e){}},30))}document.readyState==="complete"&&f()}return c.version="2.0.1",c.load=function(e,t,n,r){r.isBuild?n(null):c(n)},c}),define("mixins/event-emitter",[],function(){var e=function(t){var n=function(t,n,r,i){var u=t[n]||(t[n]=[]);u.push({callback:r,context:i||window||null}),i&&(i.on!==s&&e.apply(i),n!=="silenceEvents"&&i.on("silenceEvents",function(){o.call(this,n,r,i)},this))},r=function(e,t,n,r){var i=e[t],s;if(!i)return;!n&&!r&&(i.length=[]);for(s=i.length-1;s>=0;s--)(!n&&i[s].context===r||i[s].callback===n&&(!r||!i[s].context||i[s].context===r))&&i.splice(s,1)},i=function(e,t,n){var r=e[t],i=0,s;if(!r)return;for(s=r.length;i<s;i++)r[i].callback.call(r[i].context,n,t,this)},s=function(e,t,r){if(typeof e!="string")throw"provide a string name for the event to subscribe to";if(typeof t!="function")throw"provide a callback for the event to subscribe to";var i=a(this),s=e.split(" ");for(var o=0,u=s.length;o<u;o++)n.call(this,i,s[o],t,r)},o=function(e,t,n){if(typeof e!="string")throw"provide a string name for the event to unsubscribe from";var i=a(this,!0),s=e.split(" ");if(!i)return!1;for(var o=0,u=s.length;o<u;o++)r.call(this,i,s[o],t,n)},u=function(e,t){var n=a(this),r=e.split(" ");for(var s=0,o=r.length;s<o;s++)i.call(this,n,r[s],t)},a=function(e,n){for(var r=0,i=l.length;r<i;r++)if(l[r]===e)return f[r];return n?t:(l.push(e),f.push([]),f[f.length-1])},f=[],l=[],c=function(){return this.on=s,this.off=o,this.fire=u,this};return c.cleanUp=function(){f=[],l=[]},c}(undefined);return e}),define("utils",[],function(){var e=function(e){var t,n=0;for(var r in e)Math.random()<1/++n&&(t=r);return t},t=function(e){var t;for(var n in e)t=e[n],t._propertyDefinition&&(delete e[n],Object.defineProperty(e,n,t));return e},n=function(e){var t=Array.prototype.slice.call(arguments,1),r;if(!t.length)return e;t.length>1?(r=t.pop(),e=n.apply(this,Array.prototype.concat.apply([e],t))):r=t[0];for(var i in r)e[i]=r[i];return e},r=function(e){return e.replace(/\-\w/g,function(e){return e.charAt(1).toUpperCase()})},i=function(e){return e.replace(/[^A-Z][A-Z]/g,function(e){return e.charAt(0)+"-"+e.charAt(1).toLowerCase()})},s=function(e){return e.replace(/-/g," ")},o=function(e){return s(i(e))};return{pickRandomProperty:e,defineProps:t,extendObj:n,toCamel:r,toDashed:i,dashedToSpaced:s,camelToSpaced:o}}),define("modules/driller",["mixins/event-emitter","utils"],function(e,t){var n="Left",r="Right",i="North",s="South",o="East",u="West",a=[i,o,s,u],f=function(e){this.discipline=e&&e.discipline||f.defaults.discipline,this.conf=t.extendObj({},f.defaults,f.disciplineConfigs[this.discipline],e||{}),this.init()};return f.defaults={discipline:"taiChi",disabledSteps:[],minTime:1,maxTime:2,areaWidth:4,areaLength:4,stepCount:-1},f.addDiscipline=function(e){if(!e.name)throw"name must be defined for any discipline config";f.disciplineConfigs[e.name]=e,t.defineProps(e.steps)},f.disciplineConfigs={},f.prototype={init:function(e){var t=this.conf.startPosition||{},n=this;this.disabledSteps={},this.conf.disabledSteps.map(function(e){n.disabledSteps[e]=!0}),this.coords=(this.conf.preservePosition?this.coords:t.coords)||[0,0],this.frontFoot=t.frontFoot||null,this.direction=this.conf.preservePosition?this.direction:t.direction,this.direction=typeof this.direction=="undefined"?0:this.direction,this.longDirection=a[this.direction],this.stepCount=this.conf.stepCount,this.conf.minTime=Math.max(this.conf.minTime,.5),this.conf.maxTime=Math.max(this.conf.maxTime,this.conf.minTime),this.fire("initialised"),this.conf.autoplay&&!e&&this.start()},_start:function(e){this.fire("started"),this.running=!0,this.startSequence=this.conf.startSequence.slice(),this.announceStep(this.startSequence.shift()),this.takeStep()},start:function(e){var t=this;if(e)this.init(!0);else if(this.running===!0)return;this.conf.delay?setTimeout(function(){t._start(e)},this.conf.delay*1e3):this._start(e)},resetAndStart:function(){this.stop(!0),this.start(!0)},announceStep:function(e){if(!this.conf.steps[e])throw"invalid step name: "+e;this.fire("step",{direction:a[this.direction],frontFoot:this.frontFoot,lastStep:e,coords:this.coords.slice()})},stop:function(e){this.running===!0&&(clearTimeout(this.timer),e||(this.endSequence=this.conf.endSequence.slice(),this.takeStep(!0)),this.fire("stopped"),this.running=!1)},takeStep:function(e){var t=this,n;if(!this.stepCount&&!e&&!this.startSequence.length)return this.stop();this.stepCount&&!this.startSequence.length&&this.stepCount--,n=this.getNextStepName(e),e?n&&(this.adjustPosition(n),this.endSequence.length&&t.takeStep(e)):this.timer=setTimeout(function(){t.adjustPosition(n),t.takeStep()},this.getTimeInterval())},getNextStepName:function(e){var t;e?t=this.endSequence.length?this.endSequence.shift():undefined:this.startSequence.length?t=this.startSequence.shift():t=this.getRandomStep();if(!t)return;return this.validateStep(t)?t:this.getNextStepName(e)},getRandomStep:function(){return t.pickRandomProperty(this.conf.steps)},validateStep:function(e){if(this.disabledSteps[e])return!1;var t=this.adjustPosition(e,!0);return t[0]>=0&&t[1]>=0&&t[1]<this.conf.areaWidth&&t[0]<this.conf.areaLength},adjustPosition:function(e,t){var i,s,o,u,f,l,c,h;f=this.conf.steps[e];if(!f)throw"invalid step name: "+e;l=(this.direction+(this.frontFoot===n?1:-1)*f.direction+4)%4,c=a[l],s=f.move[1]*(this.frontFoot===n?1:-1),o=f.move[0],h=f.frontFoot===n?n:f.frontFoot===r?r:f.frontFoot===1?this.frontFoot===r?n:r:this.frontFoot;switch(l){case 0:i=[o,s];break;case 1:i=[-s,o];break;case 2:i=[-o,-s];break;case 3:i=[s,-o]}u=[this.coords[0]+i[0],this.coords[1]+i[1]];if(t)return u;this.coords=u,this.currentStep=f,this.direction=l,this.longDirection=c,this.frontFoot=h,this.announceStep(e)},getTimeInterval:function(){var e=2,t=this.conf.maxTime-this.conf.minTime,n=e+t*Math.random();return n=Math.max(Math.min(this.conf.maxTime,n),this.conf.minTime),n*1e3},enableStep:function(e){var t=this.conf.disabledSteps.indexOf(e);this.disabledSteps[e]=!1,t>-1&&(this.conf.disabledSteps.splice(t,1),this.fire("configChange",{disabledSteps:this.conf.disabledSteps}))},disableStep:function(e){var t=this.conf.disabledSteps.indexOf(e);this.disabledSteps[e]=!0,t===-1&&(this.conf.disabledSteps.push(e),this.fire("configChange",{disabledSteps:this.conf.disabledSteps}))},updateSettings:function(e){this.conf=t.extendObj(this.conf,e)}},e.apply(f.prototype),f}),define("modules/caller",["utils"],function(e){var t="Left",n="Right",r="North",i="South",s="East",o="West",u=[r,s,i,o],a=function(e){if(!e.on)throw"driller must implement event emitter";this.driller=e,this.init()};return a.prototype={init:function(){this.speaker=document.createElement("audio"),this.speaker.preload="auto",this.speaker.autoplay=!1,document.getElementsByTagName("body")[0].appendChild(this.speaker),this.driller.on("step",this.callStep,this)},callStep:function(t){this.speaker.src="assets/audio/"+e.toDashed(this.driller.discipline)+"/"+e.toDashed(t.lastStep)+".ogg",this.speaker.play()}},a}),define("modules/simple-visualiser",["utils","domReady!"],function(e){var t={West:8592,North:8593,East:8594,South:8595},n="&nbsp;&nbsp;&nbsp;&nbsp;",r=function(e,t){this.conf=e.conf,this.driller=e,this.domNode=document.getElementById(t),this.init()};return r.prototype={init:function(){this.driller.on("initialised",function(){this.prime()},this),this.driller.on("step",function(t){this.conf.areaWidth>0&&this.conf.areaLength>0&&(this.setPosition(t.coords,t.direction,t.frontFoot),this.updateCaption(e.camelToSpaced(t.lastStep)))},this),this.prime()},prime:function(){this.conf.areaWidth>0&&this.conf.areaLength>0&&(this.undrawGrid(),this.drawCaption(),this.drawGrid(),this.setPosition(this.driller.coords,this.driller.longDirection,"center"))},drawCaption:function(){this.caption=document.createElement("h2"),this.caption.innerHTML="&nbsp;",this.domNode.appendChild(this.caption)},updateCaption:function(e){this.caption.innerHTML=e.charAt(0).toUpperCase()+e.substr(1)},drawGrid:function(){var e=document.createElement("table"),t=document.createElement("tr"),r=document.createElement("td"),i=this.conf.areaWidth,s=this.conf.areaLength,o,u,a;while(s--){u=t.cloneNode(),e.appendChild(u);for(o=0;o<i;o++)a=r.cloneNode(),a.innerHTML=n,u.appendChild(a)}this.domNode.appendChild(e),this.grid=e,e.className="floorspace"},undrawGrid:function(){this.domNode.innerHTML=""},setPosition:function(e,t,n){this.position&&this.unshowPosition();var r=this.grid.getElementsByTagName("tr")[this.conf.areaLength-1-e[0]].getElementsByTagName("td")[e[1]];r.className="current "+t.toLowerCase()+" "+(n&&n.toLowerCase()),this.position=e,r.innerHTML="&#8593;"},unshowPosition:function(){var e=this.grid.getElementsByTagName("tr")[this.conf.areaLength-1-this.position[0]].getElementsByTagName("td")[this.position[1]];e.className="",e.innerHTML=n}},r}),define("modules/control-panel",["domReady!"],function(){var e=function(e,t){if(!e.on)throw"controller must implement event emitter pattern";this.fieldList=t.fieldList,this.actionList=t.actionList,this.controller=e,this.form=document.getElementById(t.formId),this.init()};return e.prototype={init:function(){var e,t;if(this.fieldList)for(e=0,t=this.fieldList.length;e<t;e++)this.bindField(this.fieldList[e]);if(this.actionList)for(e=0,t=this.actionList.length;e<t;e++)this.bindAction(this.actionList[e])},bindField:function(e){var t=document.getElementById(e),n=this,r;if(!t){console.warn("missing field in control panel: "+e);return}r=["checkbox","radio"].indexOf(t.type)>-1?"checked":"value",t[r]=this.controller.conf[e],t.addEventListener("change",function(){var i=t[r];n.controller.conf[e]=i;var s={};s[e]=i,n.controller.fire("configChange",s)})},bindAction:function(e){var t=document.getElementById(e),n=this;if(!t){console.warn("missing button on control panel: "+e);return}t.addEventListener("click",function(){n.controller[e]()})}},e}),define("modules/step-selector",["utils","domReady!"],function(e){var t=function(e,t){this.driller=e,this.domNode=document.getElementById(t),this.init()};return t.prototype={init:function(){var e=document.createElement("p");e.textContent="Choose which steps to include in your drill",this.domNode.appendChild(e),this.createInputs()},createInputs:function(){var t,n;for(var r in this.driller.conf.steps)t=document.createElement("label"),t["for"]=r,t.textContent=e.camelToSpaced(r),n=document.createElement("input"),n.id=r,n.name="stepSelector",n.type="checkbox",this.domNode.appendChild(n),this.domNode.appendChild(t),this.bindInputToDriller(r,n)},bindInputToDriller:function(e,t){var n=this;t.checked=this.driller.conf.disabledSteps.indexOf(e)===-1,t.addEventListener("change",function(){var r;t.checked?n.driller.enableStep(e):n.driller.disableStep(e)})}},t}),define("configs/tai-chi",{name:"taiChi",steps:{step:{frontFoot:1,move:[1,0],direction:0},back:{frontFoot:1,move:[-1,0],direction:0},shift:{frontFoot:1,move:[0,0],direction:1},"switch":{frontFoot:1,move:[0,0],direction:0},inside:{frontFoot:0,move:[0,1],direction:0},outside:{frontFoot:0,move:[0,-1],direction:0},onGuard:{_propertyDefinition:!0,enumerable:!1,value:{frontFoot:"Left",move:[0,0],direction:0}},wuChi:{_propertyDefinition:!0,enumerable:!1,value:{frontFoot:!1,move:[0,0],direction:0}}},startSequence:["wuChi","onGuard"],endSequence:["wuChi"]}),define("app",["domReady!","modules/driller","modules/caller","modules/simple-visualiser","modules/control-panel","modules/step-selector","configs/tai-chi"],function(e,t,n,r,i,s,o){return{init:function(){t.addDiscipline(o);var e=new t({discipline:"taiChi",disabledSteps:["inside","outside"],delay:2});if(window.location.hash!=="#silent")var u=new n(e);var a=new i(e,{fieldList:["minTime","maxTime","areaWidth","areaLength","stepCount","delay","preservePosition"],actionList:["resetAndStart","stop"],formId:"onGuardControlPanel"}),f=new s(e,"disabledSteps"),l=new r(e,"visualiser")}}}),require.config({paths:{domReady:"../lib/requirejs-domready/domReady"},baseUrl:"src",shim:{},priority:[]}),require(["app"],function(e){e.init()}),define("main",function(){});